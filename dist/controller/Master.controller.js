sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageBox","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/Fragment","sap/viz/ui5/data/FlattenedDataset","sap/viz/ui5/controls/common/feeds/FeedItem","sap/viz/ui5/format/ChartFormatter","sap/viz/ui5/api/env/Format","./InitPage"],function(e,t,i,a,o,r,l,n,s,u,p){"use strict";return e.extend("iitp.zacmapr.controller.Master",{onInit:function(){u.numericFormatter(s.getInstance());var e=s.DefaultPattern;let t=this.getView().byId("idPopOver1");let i=this.getView().byId("vizFrame1");t.connect(i.getVizUid());t.setFormatString(e.STANDARDFLOAT);p.initPageSettings(this.getView())},_validateInput:function(e){var t="None";var i=false;if(e.getValue()===""){t="Error";i=true}e.setValueState(t);return i},onSearch:function(e){let t=this.getView().getModel("main");let r=t.setProperty("/editMode",false);let l=t.getProperty("/filter");let n=[];let s=this.getOwnerComponent().getModel();let u=this.getView(),p=[u.byId("fbukrs"),u.byId("fgjahr")],g=false;p.forEach(function(e){g=this._validateInput(e)||g},this);if(!g){for(let e in l){let t=l[e];if(t){n.push(new a({path:e,operator:o.Contains,value1:t}))}}s.read("/ES_MONPRSet",{filters:n,success:function(e){if(e.results.length>0){t.setProperty("/it_data",e.results);let i=t.getProperty("/it_data")}},error:function(e){i.show("조회 실패")}})}else{i.alert("검색조건을 입력해주세요.")}},handlePopoverPress:function(e){var t=e.getSource(),i=this.getView();if(!this._pPopover){this._pPopover=r.load({id:i.getId(),name:"sap.m.sample.Popover.view.Popover",controller:this}).then(function(e){i.addDependent(e);e.bindElement("/ProductCollection/0");return e})}this._pPopover.then(function(e){e.openBy(t)})},onSelect:function(e){let t=this.getView().getModel("main");let r=t.setProperty("/editMode",false);let l=e.getSource();let n=l.getBindingContext("main").getPath();let s=t.getProperty(n);let u=t.getProperty("/filter");u.matnr=s.matnr;let p=[];let g=this.getOwnerComponent().getModel();let h=this.getView(),d=[h.byId("fbukrs"),h.byId("fgjahr")],f=false;d.forEach(function(e){f=this._validateInput(e)||f},this);if(!f){for(let e in u){let t=u[e];if(t){p.push(new a({path:e,operator:o.Contains,value1:t}))}}}g.read("/ES_MAPRSet",{filters:p,success:function(e){if(e.results.length>0){t.setProperty("/it_data2",e.results);let i=t.getProperty("/it_data2");for(let e=0;e<i.length;e++){i[e].spmon=i[e].spmon.slice(0,4)+"."+i[e].spmon.slice(4,6)}}},error:function(e){i.show("조회 실패")}})},onValueHelpRequestForBukrs:function(e){this._bukrs=e.getSource().getId();if(!this._oValueHelpDialog){this._oValueHelpDialog=sap.ui.xmlfragment("iitp.zacmapr.view.vhBuk",this);this.getView().addDependent(this._oValueHelpDialog)}this._oValueHelpDialog.open()},onValueHelpRequestForGjahr:function(e){this._gjahr=e.getSource().getId();if(!this._oValueHelpDialog1){this._oValueHelpDialog1=sap.ui.xmlfragment("iitp.zacmapr.view.vhGja",this);this.getView().addDependent(this._oValueHelpDialog1)}this._oValueHelpDialog1.open()},onValueHelpClose:function(e){let t=e.getParameter("selectedItem");if(t){let e=this.getView().byId(this._bukrs);e.setValue(t.getTitle())}},onValueHelpClose1:function(e){let t=e.getParameter("selectedItem");if(t){let e=this.getView().byId(this._gjahr);e.setValue(t.getTitle())}},onValueHelpSearch:function(e){let t=e.getParameter("value");let i=a("bukrs","EQ",t);e.getSource().getBinding("items").filter(i)},onValueHelpSearch1:function(e){let t=e.getParameter("value");let i=a("gjahr","EQ",t);e.getSource().getBinding("items").filter(i)}})});